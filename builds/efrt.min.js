/* efrt trie-compression v0.0.5  github.com/nlp-compromise/efrt  - MIT */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.efrt=e()}}(function(){var e;return function e(t,n,i){function o(s,u){if(!n[s]){if(!t[s]){var f="function"==typeof require&&require;if(!u&&f)return f(s,!0);if(r)return r(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return o(n?n:e)},c,c.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){"use strict";t.exports={NODE_SEP:";",STRING_SEP:",",TERMINAL_PREFIX:"!",NOT_ALLOWED:new RegExp("[0-9A-Z,;!]"),BASE:36}},{}],2:[function(e,t,n){"use strict";var i=36,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",r=o.split("").reduce(function(e,t,n){return e[t]=n,e},{}),s=function(e){if(void 0!==o[e])return o[e];for(var t=1,n=i,r="";e>=n;e-=n,t++,n*=i);for(;t--;){var s=e%i;r=String.fromCharCode((s<10?48:55)+s)+r,e=(e-s)/i}return r},u=function(e){if(void 0!==r[e])return r[e];for(var t=0,n=1,o=i,s=1;n<e.length;t+=o,n++,o*=i);for(var u=e.length-1;u>=0;u--,s*=i){var f=e.charCodeAt(u)-48;f>10&&(f-=7),t+=f*s}return t};t.exports={toAlphaCode:s,fromAlphaCode:u}},{}],3:[function(t,n,i){(function(i){"use strict";var o={pack:t("./pack/index"),unpack:t("./unpack/index")};"undefined"!=typeof self?self.efrt=o:"undefined"!=typeof window?window.efrt=o:"undefined"!=typeof i&&(i.efrt=o),"function"==typeof e&&e.amd&&e(o),"undefined"!=typeof n&&(n.exports=o)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./pack/index":6,"./unpack/index":9}],4:[function(e,t,n){"use strict";var i=function(e,t){for(var n=Math.min(e.length,t.length);n>0;){var i=e.slice(0,n);if(i===t.slice(0,n))return i;n-=1}return""},o=function(e){e.sort();for(var t=1;t<e.length;t++)e[t-1]===e[t]&&e.splice(t,1)};t.exports={commonPrefix:i,unique:o}},{}],5:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(){i(this,e),this.counts={}}return o(e,[{key:"init",value:function(e){void 0===this.counts[e]&&(this.counts[e]=0)}},{key:"add",value:function(e,t){void 0===t&&(t=1),this.init(e),this.counts[e]+=t}},{key:"change",value:function(e,t,n){void 0===n&&(n=1),this.add(t,-n),this.add(e,n)}},{key:"countOf",value:function(e){return this.init(e),this.counts[e]}},{key:"highest",value:function(e){for(var t=[],n=Object.keys(this.counts),i=0;i<n.length;i++){var o=n[i];t.push([o,this.counts[o]])}return t.sort(function(e,t){return t[1]-e[1]}),e&&(t=t.slice(0,e)),t}}]),e}();t.exports=r},{}],6:[function(e,t,n){"use strict";var i=e("./trie"),o=function(e){var t=new i(e);return t.pack()};t.exports=o},{"./trie":8}],7:[function(e,t,n){"use strict";var i=e("./histogram"),o=e("../config"),r=e("../encoding"),s=function(e,t){var n="",i="";e.isTerminal(t)&&(n+=o.TERMINAL_PREFIX);for(var s=e.nodeProps(t),u=0;u<s.length;u++){var f=s[u];if("number"!=typeof t[f])if(e.syms[t[f]._n])n+=i+f+e.syms[t[f]._n],i="";else{var a=r.toAlphaCode(t._n-t[f]._n-1+e.symCount);t[f]._g&&a.length>=t[f]._g.length&&1===t[t[f]._g]?(a=t[f]._g,n+=i+f+a,i=o.STRING_SEP):(n+=i+f+a,i="")}else n+=i+f,i=o.STRING_SEP}return n},u=function e(t,n){if(!t.visited(n))for(var i=t.nodeProps(n,!0),s=0;s<i.length;s++){var u=i[s],f=n._n-n[u]._n-1;f<o.BASE&&t.histRel.add(f),t.histAbs.add(n[u]._n,r.toAlphaCode(f).length-1),e(t,n[u])}},f=function(e){e.histAbs=e.histAbs.highest(o.BASE);var t=[];t[-1]=0;for(var n=0,i=0,s=3+r.toAlphaCode(e.nodeCount).length,u=0;u<o.BASE&&void 0!==e.histAbs[u];u++)t[u]=e.histAbs[u][1]-s-e.histRel.countOf(o.BASE-u-1)+t[u-1],t[u]>=n&&(n=t[u],i=u+1);return i},a=function e(t,n){if(void 0===n._n){for(var i=t.nodeProps(n,!0),o=0;o<i.length;o++)e(t,n[i[o]]);n._n=t.pos++,t.nodes.unshift(n)}},c=function(e){e.nodes=[],e.nodeCount=0,e.syms={},e.symCount=0,e.pos=0,e.optimize(),e.histAbs=new i,e.histRel=new i,a(e,e.root),e.nodeCount=e.nodes.length,e.prepDFS(),u(e,e.root),e.symCount=f(e);for(var t=0;t<e.symCount;t++)e.syms[e.histAbs[t][0]]=r.toAlphaCode(t);for(var n=0;n<e.nodeCount;n++)e.nodes[n]=s(e,e.nodes[n]);for(var c=e.symCount-1;c>=0;c--)e.nodes.unshift(r.toAlphaCode(c)+":"+r.toAlphaCode(e.nodeCount-e.histAbs[c][0]-1));return e.nodes.join(o.NODE_SEP)};t.exports=c},{"../config":1,"../encoding":2,"./histogram":5}],8:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=e("./fns"),u=e("./pack"),f=e("../config"),a=function(){function e(t){i(this,e),this.root={},this.lastWord="",this.suffixes={},this.suffixCounts={},this.cNext=1,this.wordCount=0,this.insertWords(t),this.vCur=0}return r(e,[{key:"insertWords",value:function(e){if(void 0!==e){"string"==typeof e&&(e=e.split(/[^a-zA-Z]+/));for(var t=0;t<e.length;t++)e[t]=e[t].toLowerCase();s.unique(e);for(var n=0;n<e.length;n++)null===e[n].match(f.NOT_ALLOWED)&&this.insert(e[n])}}},{key:"insert",value:function(e){this._insert(e,this.root);var t=this.lastWord;this.lastWord=e;var n=s.commonPrefix(e,t);if(n!==t){var i=this.uniqueNode(t,e,this.root);i&&this.combineSuffixNode(i)}}},{key:"_insert",value:function(e,t){var n=void 0,i=void 0;if(0!==e.length){for(var r=Object.keys(t),u=0;u<r.length;u++){var f=r[u];if(n=s.commonPrefix(e,f),0!==n.length){if(f===n&&"object"===o(t[f]))return void this._insert(e.slice(n.length),t[f]);if(f===e&&"number"==typeof t[f])return;return i={},i[f.slice(n.length)]=t[f],this.addTerminal(i,e=e.slice(n.length)),delete t[f],t[n]=i,void this.wordCount++}}this.addTerminal(t,e),this.wordCount++}}},{key:"addTerminal",value:function(e,t){if(t.length<=1)return void(e[t]=1);var n={};e[t[0]]=n,this.addTerminal(n,t.slice(1))}},{key:"nodeProps",value:function(e,t){var n=[];for(var i in e)""!==i&&"_"!==i[0]&&(t&&"object"!==o(e[i])||n.push(i));return n.sort(),n}},{key:"optimize",value:function(){this.combineSuffixNode(this.root),this.prepDFS(),this.countDegree(this.root),this.prepDFS(),this.collapseChains(this.root)}},{key:"combineSuffixNode",value:function(e){if(e._c)return e;var t=[];this.isTerminal(e)&&t.push("!");for(var n=this.nodeProps(e),i=0;i<n.length;i++){var r=n[i];"object"===o(e[r])?(e[r]=this.combineSuffixNode(e[r]),t.push(r),t.push(e[r]._c)):t.push(r)}t=t.join("-");var s=this.suffixes[t];return s?s:(this.suffixes[t]=e,e._c=this.cNext++,e)}},{key:"prepDFS",value:function(){this.vCur++}},{key:"visited",value:function(e){return e._v===this.vCur||(e._v=this.vCur,!1)}},{key:"countDegree",value:function(e){if(void 0===e._d&&(e._d=0),e._d++,!this.visited(e))for(var t=this.nodeProps(e,!0),n=0;n<t.length;n++)this.countDegree(e[t[n]])}},{key:"collapseChains",value:function(e){var t=void 0,n=void 0,i=void 0,r=void 0;if(!this.visited(e)){for(n=this.nodeProps(e),r=0;r<n.length;r++)t=n[r],i=e[t],"object"===("undefined"==typeof i?"undefined":o(i))&&(this.collapseChains(i),void 0===i._g||1!==i._d&&1!==i._g.length||(delete e[t],t+=i._g,e[t]=i[i._g]));1!==n.length||this.isTerminal(e)||(e._g=t)}}},{key:"has",value:function(e){return this.isFragment(e,this.root)}},{key:"isTerminal",value:function(e){return!!e[""]}},{key:"isFragment",value:function(e,t){if(0===e.length)return this.isTerminal(t);if(1===t[e])return!0;for(var n=this.nodeProps(t,!0),i=0;i<n.length;i++){var o=n[i];if(o===e.slice(0,o.length))return this.isFragment(e.slice(o.length),t[o])}return!1}},{key:"uniqueNode",value:function(e,t,n){for(var i=this.nodeProps(n,!0),o=0;o<i.length;o++){var r=i[o];if(r===e.slice(0,r.length))return r!==t.slice(0,r.length)?n[r]:this.uniqueNode(e.slice(r.length),t.slice(r.length),n[r])}}},{key:"pack",value:function(){return u(this)}}]),e}();t.exports=a},{"../config":1,"./fns":4,"./pack":7}],9:[function(e,t,n){"use strict";var i=e("./ptrie"),o=function(e){return new i(e)};t.exports=o},{"./ptrie":12}],10:[function(e,t,n){"use strict";var i=e("../encoding"),o=e("./prefix"),r=e("./unravel"),s={has:function(e){var t=this;if(!e)return!1;if(this._cache)return this._cache[e]||!1;var n=function n(i,r){var s=t.nodes[i];if("!"===s[0]){if(r===e)return!0;s=s.slice(1)}for(var u=s.split(/([A-Z0-9,]+)/g),f=0;f<u.length;f+=2){var a=u[f],c=u[f+1];if(a){var h=r+a;if(","!==c&&void 0!==c){if(o(h,e))return i=t.indexFromRef(c,i),n(i,h)}else if(h===e)return!0}}return!1};return n(0,"")},indexFromRef:function(e,t){var n=i.fromAlphaCode(e);return n<this.symCount?this.syms[n]:t+n+1-this.symCount},toArray:function(){return Object.keys(this.toObject())},toObject:function(){return this._cache?this._cache:r(this)},cache:function(){this._cache=r(this),this.nodes=null,this.syms=null}};t.exports=s},{"../encoding":2,"./prefix":11,"./unravel":14}],11:[function(e,t,n){"use strict";var i=function(e,t){if(e===t)return!0;var n=e.length;return!(n>=t.length)&&(1===n?e===t[0]:t.slice(0,n)===e)};t.exports=i},{}],12:[function(e,t,n){"use strict";var i=e("./symbols"),o=e("./methods"),r=function(e){this.nodes=e.split(";"),this.syms=[],this.symCount=0,this._cache=null,e.match(":")&&i(this)};Object.keys(o).forEach(function(e){r.prototype[e]=o[e]}),t.exports=r},{"./methods":10,"./symbols":13}],13:[function(e,t,n){"use strict";var i=function(e){for(var t=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),n=0;n<e.nodes.length;n++){var i=t.exec(e.nodes[n]);if(!i){e.symCount=n;break}e.syms[encoding.fromAlphaCode(i[1])]=encoding.fromAlphaCode(i[2])}e.nodes=e.nodes.slice(e.symCount,e.nodes.length)};t.exports=i},{}],14:[function(e,t,n){"use strict";var i=function(e){var t={},n=function n(i,o){var r=e.nodes[i];"!"===r[0]&&(t[o]=!0,r=r.slice(1));for(var s=r.split(/([A-Z0-9,]+)/g),u=0;u<s.length;u+=2){var f=s[u],a=s[u+1];if(f){var c=o+f;if(","!==a&&void 0!==a){var h=e.indexFromRef(a,i);n(h,c)}else t[c]=!0}}};return n(0,""),t};t.exports=i},{}]},{},[3])(3)});
