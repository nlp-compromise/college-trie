!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.trieHard=e()}}(function(){return function e(t,n,i){function r(u,s){if(!n[u]){if(!t[u]){var f="function"==typeof require&&require;if(!s&&f)return f(u,!0);if(o)return o(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var c=n[u]={exports:{}};t[u][0].call(c.exports,function(e){var n=t[u][1][e];return r(n?n:e)},c,c.exports,e,t,n,i)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<i.length;u++)r(i[u]);return r}({1:[function(e,t,n){"use strict";t.exports={NODE_SEP:";",STRING_SEP:",",TERMINAL_PREFIX:"!",BASE:36}},{}],2:[function(e,t,n){"use strict";var i=e("./config"),r=function(e){var t,n,r,o="";for(t=1,n=i.BASE;e>=n;e-=n,t++,n*=i.BASE);for(;t--;)r=e%i.BASE,o=String.fromCharCode((r<10?48:55)+r)+o,e=(e-r)/i.BASE;return o},o=function(e){var t,n,r,o,u,s=0;for(t=1,n=i.BASE;t<e.length;s+=n,t++,n*=i.BASE);for(o=e.length-1,r=1;o>=0;o--,r*=i.BASE)u=e.charCodeAt(o)-48,u>10&&(u-=7),s+=u*r;return s},u=function(e){e.sort();for(var t=1;t<e.length;t++)e[t-1]===e[t]&&e.splice(t,1)},s=function(e,t){for(var n=Math.min(e.length,t.length);n>0;){var i=e.slice(0,n);if(i===t.slice(0,n))return i;n-=1}return""};t.exports={toAlphaCode:r,fromAlphaCode:o,unique:u,commonPrefix:s}},{"./config":1}],3:[function(e,t,n){"use strict";t.exports={pack:e("./pack/index"),unpack:e("./unpack/index")}},{"./pack/index":5,"./unpack/index":8}],4:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e),this.counts={}}return r(e,[{key:"init",value:function(e){void 0===this.counts[e]&&(this.counts[e]=0)}},{key:"add",value:function(e,t){void 0===t&&(t=1),this.init(e),this.counts[e]+=t}},{key:"change",value:function(e,t,n){void 0===n&&(n=1),this.add(t,-n),this.add(e,n)}},{key:"countOf",value:function(e){return this.init(e),this.counts[e]}},{key:"highest",value:function(e){for(var t=[],n=Object.keys(this.counts),i=0;i<n.length;i++){var r=n[i];t.push([r,this.counts[r]])}return t.sort(function(e,t){return t[1]-e[1]}),e&&(t=t.slice(0,e)),t}}]),e}();t.exports=o},{}],5:[function(e,t,n){"use strict";var i=e("./trie"),r=function(e){var t=new i(e);return t.pack()};t.exports=r},{"./trie":7}],6:[function(e,t,n){"use strict";function i(e,t,n,r){if(!e.visited(t))for(var o=e.nodeProps(t,!0),f=0;f<o.length;f++){var a=o[f],c=t._n-t[a]._n-1;c<u.BASE&&r.add(c),n.add(t[a]._n,s.toAlphaCode(c).length-1),i(e,t[a],n,r)}}function r(e,t,n){e=e.highest(u.BASE);var i=[];i[-1]=0;for(var r=0,o=0,f=3+s.toAlphaCode(n).length,a=0;a<u.BASE&&void 0!==e[a];a++)i[a]=e[a][1]-f-t.countOf(u.BASE-a-1)+i[a-1],i[a]>=r&&(r=i[a],o=a+1);return o}var o=e("./histogram"),u=e("../config"),s=e("../fns"),f=function(e){function t(t){var n="",i="";e.isTerminal(t)&&(n+=u.TERMINAL_PREFIX);for(var r=e.nodeProps(t),o=0;o<r.length;o++){var f=r[o];if("number"!=typeof t[f])if(c[t[f]._n])n+=i+f+c[t[f]._n],i="";else{var a=s.toAlphaCode(t._n-t[f]._n-1+h);t[f]._g&&a.length>=t[f]._g.length&&1===t[t[f]._g]?(a=t[f]._g,i=u.STRING_SEP):(n+=i+f+a,i="")}else n+=i+f,i=u.STRING_SEP}return n}function n(t){if(void 0===t._n){for(var i=e.nodeProps(t,!0),r=0;r<i.length;r++)n(t[i[r]]);t._n=l++,f.unshift(t)}}var f=[],a=void 0,c={},h=void 0,l=0;e.optimize();var d=new o,v=new o;n(e.root,0),a=f.length,e.prepDFS(),i(e,e.root,d,v),h=r(d,v,a);for(var p=0;p<h;p++)c[d[p][0]]=s.toAlphaCode(p);for(var g=0;g<a;g++)f[g]=t(f[g]);for(var y=h-1;y>=0;y--)f.unshift(s.toAlphaCode(y)+":"+s.toAlphaCode(a-d[y][0]-1));return f.join(u.NODE_SEP)};t.exports=f},{"../config":1,"../fns":2,"./histogram":4}],7:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=(e("../config"),e("./histogram"),e("../fns")),s=e("./packer"),f=function(){function e(t){i(this,e),this.root={},this.lastWord="",this.suffixes={},this.suffixCounts={},this.cNext=1,this.wordCount=0,this.insertWords(t),this.vCur=0}return o(e,[{key:"insertWords",value:function(e){"string"==typeof e&&(e=e.split(/\n/)),u.unique(e);for(var t=0;t<e.length;t++)this.insert(e[t])}},{key:"insert",value:function(e){this._insert(e,this.root);var t=this.lastWord;this.lastWord=e;var n=u.commonPrefix(e,t);if(n!==t){var i=this.uniqueNode(t,e,this.root);i&&this.combineSuffixNode(i)}}},{key:"_insert",value:function(e,t){for(var n=Object.keys(t),i=0;i<n.length;i++){var o=n[i],s=u.commonPrefix(e,o);if(0!==s.length){if(o===s&&"object"===r(t[o]))return void this._insert(e.slice(s.length),t[o]);if(o===e&&"number"==typeof t[o])return;var f={};return f[o.slice(s.length)]=t[o],this.addTerminal(f,e=e.slice(s.length)),delete t[o],t[s]=f,void this.wordCount++}}this.addTerminal(t,e),this.wordCount++}},{key:"addTerminal",value:function(e,t){if(t.length<=1)return void(e[t]=1);var n={};e[t[0]]=n,this.addTerminal(n,t.slice(1))}},{key:"nodeProps",value:function(e,t){var n=[];for(var i in e)""!==i&&"_"!==i[0]&&(t&&"object"!==r(e[i])||n.push(i));return n.sort(),n}},{key:"optimize",value:function(){this.combineSuffixNode(this.root),this.prepDFS(),this.countDegree(this.root),this.prepDFS(),this.collapseChains(this.root)}},{key:"combineSuffixNode",value:function(e){if(e._c)return e;var t=[];this.isTerminal(e)&&t.push("!");for(var n=this.nodeProps(e),i=0;i<n.length;i++){var o=n[i];"object"===r(e[o])?(e[o]=this.combineSuffixNode(e[o]),t.push(o),t.push(e[o]._c)):t.push(o)}t=t.join("-");var u=this.suffixes[t];return u?u:(this.suffixes[t]=e,e._c=this.cNext++,e)}},{key:"prepDFS",value:function(){this.vCur++}},{key:"visited",value:function(e){return e._v===this.vCur||(e._v=this.vCur,!1)}},{key:"countDegree",value:function(e){if(void 0===e._d&&(e._d=0),e._d++,!this.visited(e))for(var t=this.nodeProps(e,!0),n=0;n<t.length;n++)this.countDegree(e[t[n]])}},{key:"collapseChains",value:function(e){var t=void 0,n=void 0,i=void 0,o=void 0;if(!this.visited(e)){for(n=this.nodeProps(e),o=0;o<n.length;o++)t=n[o],i=e[t],"object"===("undefined"==typeof i?"undefined":r(i))&&(this.collapseChains(i),void 0===i._g||1!==i._d&&1!==i._g.length||(delete e[t],t+=i._g,e[t]=i[i._g]));1!==n.length||this.isTerminal(e)||(e._g=t)}}},{key:"isWord",value:function(e){return this.isFragment(e,this.root)}},{key:"isTerminal",value:function(e){return!!e[""]}},{key:"isFragment",value:function(e,t){if(0===e.length)return this.isTerminal(t);if(1===t[e])return!0;for(var n=this.nodeProps(t,!0),i=0;i<n.length;i++){var r=n[i];if(r===e.slice(0,r.length))return this.isFragment(e.slice(r.length),t[r])}return!1}},{key:"uniqueNode",value:function(e,t,n){for(var i=this.nodeProps(n,!0),r=0;r<i.length;r++){var o=i[r];if(o===e.slice(0,o.length))return o!==t.slice(0,o.length)?n[o]:this.uniqueNode(e.slice(o.length),t.slice(o.length),n[o])}}},{key:"pack",value:function(){return s(this)}}]),e}();t.exports=f},{"../config":1,"../fns":2,"./histogram":4,"./packer":6}],8:[function(e,t,n){"use strict";var i=e("./ptrie"),r=function(e){return new i(e)};t.exports=r},{"./ptrie":9}],9:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("../config"),u=e("../fns"),s=new RegExp("([a-z ]+)("+o.STRING_SEP+"|[0-9A-Z]+|$)","g"),f=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),a="zzzzzzzzzz",c=function(){function e(t){for(i(this,e),this.nodes=t.split(o.NODE_SEP),this.syms=[],this.symCount=0;;){var n=f.exec(this.nodes[0]);if(!n)break;this.syms[u.fromAlphaCode(n[1])]=u.fromAlphaCode(n[2]),this.symCount++,this.nodes.shift()}}return r(e,[{key:"isWord",value:function(e){return""!==e&&this.match(e)===e}},{key:"match",value:function(e){var t=this.matches(e);return 0===t.length?"":t[t.length-1]}},{key:"matches",value:function(e){return this.words(e,e+"a")}},{key:"max",value:function(){return a}},{key:"words",value:function e(t,n,i){function r(t){return e.length>=i?void(this.abort=!0):void e.push(t)}var e=[];return void 0===t&&(t=""),"number"==typeof n&&(i=n,n=void 0),void 0===n&&(n=this.beyond(t)),this.enumerate(0,"",{from:t,beyond:n,fn:r,prefixes:t+"a"===n}),e}},{key:"enumerate",value:function(e,t,n){function i(e){return n.prefixes?void(e===n.from.slice(0,e.length)&&n.fn(e)):void(n.from<=e&&e<n.beyond&&n.fn(e))}var r=this.nodes[e],u=this;if(r[0]===o.TERMINAL_PREFIX){if(i(t),n.abort)return;r=r.slice(1)}r.replace(s,function(r,s,f){var a=t+s;if(!(n.abort||a>=n.beyond||a<n.from.slice(0,a.length))){var c=f===o.STRING_SEP||""===f;return c?void i(a):void u.enumerate(u.inodeFromRef(f,e),a,n)}})}},{key:"inodeFromRef",value:function(e,t){var n=u.fromAlphaCode(e);return n<this.symCount?this.syms[n]:t+n+1-this.symCount}},{key:"beyond",value:function(e){if(0===e.length)return this.max();var t=e.charCodeAt(e.length-1);return e.slice(0,-1)+String.fromCharCode(t+1)}}]),e}();t.exports=c},{"../config":1,"../fns":2}]},{},[3])(3)});
