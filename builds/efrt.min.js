/* efrt trie-compression v0.0.5  github.com/nlp-compromise/efrt  - MIT */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.efrt=e()}}(function(){return function e(t,n,i){function r(s,u){if(!n[s]){if(!t[s]){var f="function"==typeof require&&require;if(!u&&f)return f(s,!0);if(o)return o(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return r(n?n:e)},c,c.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){"use strict";t.exports={NODE_SEP:";",STRING_SEP:",",TERMINAL_PREFIX:"!",NOT_ALLOWED:new RegExp("[0-9A-Z,;!]"),BASE:36}},{}],2:[function(e,t,n){"use strict";var i=e("./config"),r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",o=r.split("").reduce(function(e,t,n){return e[t]=n,e},{}),s=function(e){if(void 0!==r[e])return r[e];for(var t=1,n=i.BASE,o="";e>=n;e-=n,t++,n*=i.BASE);for(;t--;){var s=e%i.BASE;o=String.fromCharCode((s<10?48:55)+s)+o,e=(e-s)/i.BASE}return o},u=function(e){if(void 0!==o[e])return o[e];for(var t=0,n=1,r=i.BASE,s=1;n<e.length;t+=r,n++,r*=i.BASE);for(var u=e.length-1;u>=0;u--,s*=i.BASE){var f=e.charCodeAt(u)-48;f>10&&(f-=7),t+=f*s}return t},f=function(e){e.sort();for(var t=1;t<e.length;t++)e[t-1]===e[t]&&e.splice(t,1)},a=function(e,t){for(var n=Math.min(e.length,t.length);n>0;){var i=e.slice(0,n);if(i===t.slice(0,n))return i;n-=1}return""};t.exports={toAlphaCode:s,fromAlphaCode:u,unique:f,commonPrefix:a}},{"./config":1}],3:[function(e,t,n){"use strict";t.exports={pack:e("./pack/index"),unpack:e("./unpack/index")}},{"./pack/index":5,"./unpack/index":8}],4:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e),this.counts={}}return r(e,[{key:"init",value:function(e){void 0===this.counts[e]&&(this.counts[e]=0)}},{key:"add",value:function(e,t){void 0===t&&(t=1),this.init(e),this.counts[e]+=t}},{key:"change",value:function(e,t,n){void 0===n&&(n=1),this.add(t,-n),this.add(e,n)}},{key:"countOf",value:function(e){return this.init(e),this.counts[e]}},{key:"highest",value:function(e){for(var t=[],n=Object.keys(this.counts),i=0;i<n.length;i++){var r=n[i];t.push([r,this.counts[r]])}return t.sort(function(e,t){return t[1]-e[1]}),e&&(t=t.slice(0,e)),t}}]),e}();t.exports=o},{}],5:[function(e,t,n){"use strict";var i=e("./trie"),r=function(e){var t=new i(e);return t.pack()};t.exports=r},{"./trie":7}],6:[function(e,t,n){"use strict";var i=e("./histogram"),r=e("../config"),o=e("../fns"),s=function(e,t){var n="",i="";e.isTerminal(t)&&(n+=r.TERMINAL_PREFIX);for(var s=e.nodeProps(t),u=0;u<s.length;u++){var f=s[u];if("number"!=typeof t[f])if(e.syms[t[f]._n])n+=i+f+e.syms[t[f]._n],i="";else{var a=o.toAlphaCode(t._n-t[f]._n-1+e.symCount);t[f]._g&&a.length>=t[f]._g.length&&1===t[t[f]._g]?(a=t[f]._g,n+=i+f+a,i=r.STRING_SEP):(n+=i+f+a,i="")}else n+=i+f,i=r.STRING_SEP}return n},u=function e(t,n){if(!t.visited(n))for(var i=t.nodeProps(n,!0),s=0;s<i.length;s++){var u=i[s],f=n._n-n[u]._n-1;f<r.BASE&&t.histRel.add(f),t.histAbs.add(n[u]._n,o.toAlphaCode(f).length-1),e(t,n[u])}},f=function(e){e.histAbs=e.histAbs.highest(r.BASE);var t=[];t[-1]=0;for(var n=0,i=0,s=3+o.toAlphaCode(e.nodeCount).length,u=0;u<r.BASE&&void 0!==e.histAbs[u];u++)t[u]=e.histAbs[u][1]-s-e.histRel.countOf(r.BASE-u-1)+t[u-1],t[u]>=n&&(n=t[u],i=u+1);return i},a=function e(t,n){if(void 0===n._n){for(var i=t.nodeProps(n,!0),r=0;r<i.length;r++)e(t,n[i[r]]);n._n=t.pos++,t.nodes.unshift(n)}},c=function(e){e.nodes=[],e.nodeCount=0,e.syms={},e.symCount=0,e.pos=0,e.optimize(),e.histAbs=new i,e.histRel=new i,a(e,e.root),e.nodeCount=e.nodes.length,e.prepDFS(),u(e,e.root),e.symCount=f(e);for(var t=0;t<e.symCount;t++)e.syms[e.histAbs[t][0]]=o.toAlphaCode(t);for(var n=0;n<e.nodeCount;n++)e.nodes[n]=s(e,e.nodes[n]);for(var c=e.symCount-1;c>=0;c--)e.nodes.unshift(o.toAlphaCode(c)+":"+o.toAlphaCode(e.nodeCount-e.histAbs[c][0]-1));return e.nodes.join(r.NODE_SEP)};t.exports=c},{"../config":1,"../fns":2,"./histogram":4}],7:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=e("../fns"),u=e("./pack"),f=e("../config"),a=function(){function e(t){i(this,e),this.root={},this.lastWord="",this.suffixes={},this.suffixCounts={},this.cNext=1,this.wordCount=0,this.insertWords(t),this.vCur=0}return o(e,[{key:"insertWords",value:function(e){if(void 0!==e){"string"==typeof e&&(e=e.split(/[^a-zA-Z]+/));for(var t=0;t<e.length;t++)e[t]=e[t].toLowerCase();s.unique(e);for(var n=0;n<e.length;n++)null===e[n].match(f.NOT_ALLOWED)&&this.insert(e[n])}}},{key:"insert",value:function(e){this._insert(e,this.root);var t=this.lastWord;this.lastWord=e;var n=s.commonPrefix(e,t);if(n!==t){var i=this.uniqueNode(t,e,this.root);i&&this.combineSuffixNode(i)}}},{key:"_insert",value:function(e,t){var n=void 0,i=void 0;if(0!==e.length){for(var o=Object.keys(t),u=0;u<o.length;u++){var f=o[u];if(n=s.commonPrefix(e,f),0!==n.length){if(f===n&&"object"===r(t[f]))return void this._insert(e.slice(n.length),t[f]);if(f===e&&"number"==typeof t[f])return;return i={},i[f.slice(n.length)]=t[f],this.addTerminal(i,e=e.slice(n.length)),delete t[f],t[n]=i,void this.wordCount++}}this.addTerminal(t,e),this.wordCount++}}},{key:"addTerminal",value:function(e,t){if(t.length<=1)return void(e[t]=1);var n={};e[t[0]]=n,this.addTerminal(n,t.slice(1))}},{key:"nodeProps",value:function(e,t){var n=[];for(var i in e)""!==i&&"_"!==i[0]&&(t&&"object"!==r(e[i])||n.push(i));return n.sort(),n}},{key:"optimize",value:function(){this.combineSuffixNode(this.root),this.prepDFS(),this.countDegree(this.root),this.prepDFS(),this.collapseChains(this.root)}},{key:"combineSuffixNode",value:function(e){if(e._c)return e;var t=[];this.isTerminal(e)&&t.push("!");for(var n=this.nodeProps(e),i=0;i<n.length;i++){var o=n[i];"object"===r(e[o])?(e[o]=this.combineSuffixNode(e[o]),t.push(o),t.push(e[o]._c)):t.push(o)}t=t.join("-");var s=this.suffixes[t];return s?s:(this.suffixes[t]=e,e._c=this.cNext++,e)}},{key:"prepDFS",value:function(){this.vCur++}},{key:"visited",value:function(e){return e._v===this.vCur||(e._v=this.vCur,!1)}},{key:"countDegree",value:function(e){if(void 0===e._d&&(e._d=0),e._d++,!this.visited(e))for(var t=this.nodeProps(e,!0),n=0;n<t.length;n++)this.countDegree(e[t[n]])}},{key:"collapseChains",value:function(e){var t=void 0,n=void 0,i=void 0,o=void 0;if(!this.visited(e)){for(n=this.nodeProps(e),o=0;o<n.length;o++)t=n[o],i=e[t],"object"===("undefined"==typeof i?"undefined":r(i))&&(this.collapseChains(i),void 0===i._g||1!==i._d&&1!==i._g.length||(delete e[t],t+=i._g,e[t]=i[i._g]));1!==n.length||this.isTerminal(e)||(e._g=t)}}},{key:"has",value:function(e){return this.isFragment(e,this.root)}},{key:"isTerminal",value:function(e){return!!e[""]}},{key:"isFragment",value:function(e,t){if(0===e.length)return this.isTerminal(t);if(1===t[e])return!0;for(var n=this.nodeProps(t,!0),i=0;i<n.length;i++){var r=n[i];if(r===e.slice(0,r.length))return this.isFragment(e.slice(r.length),t[r])}return!1}},{key:"uniqueNode",value:function(e,t,n){for(var i=this.nodeProps(n,!0),r=0;r<i.length;r++){var o=i[r];if(o===e.slice(0,o.length))return o!==t.slice(0,o.length)?n[o]:this.uniqueNode(e.slice(o.length),t.slice(o.length),n[o])}}},{key:"pack",value:function(){return u(this)}}]),e}();t.exports=a},{"../config":1,"../fns":2,"./pack":6}],8:[function(e,t,n){"use strict";var i=e("./ptrie"),r=function(e){return new i(e)};t.exports=r},{"./ptrie":10}],9:[function(e,t,n){"use strict";var i=function(e,t){if(e===t)return!0;var n=e.length;return!(n>=t.length)&&(1===n?e===t[0]:t.slice(0,n)===e)};t.exports=i},{}],10:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("../config"),s=e("../fns"),u=e("./prefix"),f=e("./unravel"),a=function(){function e(t){i(this,e),this.nodes=t.split(o.NODE_SEP),this.syms=[],this.symCount=0,this._cache=null,t.match(":")&&this.initSymbols()}return r(e,[{key:"initSymbols",value:function(){for(var e=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),t=0;t<this.nodes.length;t++){var n=e.exec(this.nodes[t]);if(!n){this.symCount=t;break}this.syms[s.fromAlphaCode(n[1])]=s.fromAlphaCode(n[2])}this.nodes=this.nodes.slice(this.symCount,this.nodes.length)}},{key:"has",value:function(e){var t=this;if(!e)return!1;if(this._cache)return this._cache[e]||!1;var n=function n(i,r){var o=t.nodes[i];if("!"===o[0]){if(r===e)return!0;o=o.slice(1)}for(var s=o.split(/([A-Z0-9,]+)/g),f=0;f<s.length;f+=2){var a=s[f],c=s[f+1];if(a){var h=r+a;if(","!==c&&void 0!==c){if(u(h,e))return i=t.indexFromRef(c,i),n(i,h)}else if(h===e)return!0}}return!1};return n(0,"")}},{key:"indexFromRef",value:function(e,t){var n=s.fromAlphaCode(e);return n<this.symCount?this.syms[n]:t+n+1-this.symCount}},{key:"toArray",value:function(){return this._cache?Object.keys(this._cache):Object.keys(f(this))}},{key:"cache",value:function(){this._cache=f(this),this.nodes=null,this.syms=null}}]),e}();t.exports=a},{"../config":1,"../fns":2,"./prefix":9,"./unravel":11}],11:[function(e,t,n){"use strict";var i=function(e){var t={},n=function n(i,r){var o=e.nodes[i];"!"===o[0]&&(t[r]=!0,o=o.slice(1));for(var s=o.split(/([A-Z0-9,]+)/g),u=0;u<s.length;u+=2){var f=s[u],a=s[u+1];if(f){var c=r+f;if(","!==a&&void 0!==a){var h=e.indexFromRef(a,i);n(h,c)}else t[c]=!0}}};return n(0,""),t};t.exports=i},{}]},{},[3])(3)});
