"use strict";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(t,n){return t(n={exports:{}},n.exports),n.exports}const commonPrefix=function(t,n){let e=Math.min(t.length,n.length);for(;e>0;){const o=t.slice(0,e);if(o===n.slice(0,e))return o;e-=1}return""},unique=function(t){t.sort();for(let n=1;n<t.length;n++)t[n-1]===t[n]&&t.splice(n,1)};var fns={commonPrefix:commonPrefix,unique:unique};const Histogram=function(){this.counts={}},methods={init:function(t){void 0===this.counts[t]&&(this.counts[t]=0)},add:function(t,n){void 0===n&&(n=1),this.init(t),this.counts[t]+=n},countOf:function(t){return this.init(t),this.counts[t]},highest:function(t){let n=[];const e=Object.keys(this.counts);for(let t=0;t<e.length;t++){const o=e[t];n.push([o,this.counts[o]])}return n.sort(function(t,n){return n[1]-t[1]}),t&&(n=n.slice(0,t)),n}};Object.keys(methods).forEach(function(t){Histogram.prototype[t]=methods[t]});var histogram=Histogram;const BASE=36,seq="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",cache=seq.split("").reduce(function(t,n,e){return t[n]=e,t},{}),toAlphaCode=function(t){if(void 0!==seq[t])return seq[t];let n=1,e=36,o="";for(;t>=e;t-=e,n++,e*=36);for(;n--;){const n=t%36;o=String.fromCharCode((n<10?48:55)+n)+o,t=(t-n)/36}return o},fromAlphaCode=function(t){if(void 0!==cache[t])return cache[t];let n=0,e=1,o=36,s=1;for(;e<t.length;n+=o,e++,o*=36);for(let e=t.length-1;e>=0;e--,s*=36){let o=t.charCodeAt(e)-48;o>10&&(o-=7),n+=o*s}return n};var encoding={toAlphaCode:toAlphaCode,fromAlphaCode:fromAlphaCode};const config={NODE_SEP:";",KEY_VAL:":",STRING_SEP:",",TERMINAL_PREFIX:"!",BASE:36},nodeLine=function(t,n){let e="",o="";t.isTerminal(n)&&(e+=config.TERMINAL_PREFIX);const s=t.nodeProps(n);for(let i=0;i<s.length;i++){const r=s[i];if("number"==typeof n[r]){e+=o+r,o=config.STRING_SEP;continue}if(t.syms[n[r]._n]){e+=o+r+t.syms[n[r]._n],o="";continue}let c=encoding.toAlphaCode(n._n-n[r]._n-1+t.symCount);n[r]._g&&c.length>=n[r]._g.length&&1===n[n[r]._g]?(e+=o+r+(c=n[r]._g),o=config.STRING_SEP):(e+=o+r+c,o="")}return e},analyzeRefs=function(t,n){if(t.visited(n))return;const e=t.nodeProps(n,!0);for(let o=0;o<e.length;o++){const s=e[o],i=n._n-n[s]._n-1;i<config.BASE&&t.histRel.add(i),t.histAbs.add(n[s]._n,encoding.toAlphaCode(i).length-1),analyzeRefs(t,n[s])}},symbolCount=function(t){t.histAbs=t.histAbs.highest(config.BASE);const n=[];n[-1]=0;let e=0,o=0;const s=3+encoding.toAlphaCode(t.nodeCount).length;for(let i=0;i<config.BASE&&void 0!==t.histAbs[i];i++)n[i]=t.histAbs[i][1]-s-t.histRel.countOf(config.BASE-i-1)+n[i-1],n[i]>=e&&(e=n[i],o=i+1);return o},numberNodes=function(t,n){if(void 0!==n._n)return;const e=t.nodeProps(n,!0);for(let o=0;o<e.length;o++)numberNodes(t,n[e[o]]);n._n=t.pos++,t.nodes.unshift(n)},pack=function(t){t.nodes=[],t.nodeCount=0,t.syms={},t.symCount=0,t.pos=0,t.optimize(),t.histAbs=new histogram,t.histRel=new histogram,numberNodes(t,t.root),t.nodeCount=t.nodes.length,t.prepDFS(),analyzeRefs(t,t.root),t.symCount=symbolCount(t);for(let n=0;n<t.symCount;n++)t.syms[t.histAbs[n][0]]=encoding.toAlphaCode(n);for(let n=0;n<t.nodeCount;n++)t.nodes[n]=nodeLine(t,t.nodes[n]);for(let n=t.symCount-1;n>=0;n--)t.nodes.unshift(encoding.toAlphaCode(n)+config.KEY_VAL+encoding.toAlphaCode(t.nodeCount-t.histAbs[n][0]-1));return t.nodes.join(config.NODE_SEP)};var pack_1=pack;const NOT_ALLOWED=new RegExp("[0-9A-Z,;!:|¦]");var methods$1={insertWords:function(t){if(void 0!==t){"string"==typeof t&&(t=t.split(/[^a-zA-Z]+/));for(let n=0;n<t.length;n++)t[n]=t[n].toLowerCase();fns.unique(t);for(let n=0;n<t.length;n++)null===t[n].match(NOT_ALLOWED)&&this.insert(t[n])}},insert:function(t){this._insert(t,this.root);const n=this.lastWord;if(this.lastWord=t,fns.commonPrefix(t,n)===n)return;const e=this.uniqueNode(n,t,this.root);e&&this.combineSuffixNode(e)},_insert:function(t,n){let e,o;if(0===t.length)return;const s=Object.keys(n);for(let i=0;i<s.length;i++){const r=s[i];if(0!==(e=fns.commonPrefix(t,r)).length){if(r===e&&"object"==typeof n[r])return void this._insert(t.slice(e.length),n[r]);if(r===t&&"number"==typeof n[r])return;return(o={})[r.slice(e.length)]=n[r],this.addTerminal(o,t=t.slice(e.length)),delete n[r],n[e]=o,void this.wordCount++}}this.addTerminal(n,t),this.wordCount++},addTerminal:function(t,n){if(n.length<=1)return void(t[n]=1);const e={};t[n[0]]=e,this.addTerminal(e,n.slice(1))},nodeProps:function(t,n){const e=[];for(const o in t)""!==o&&"_"!==o[0]&&(n&&"object"!=typeof t[o]||e.push(o));return e.sort(),e},optimize:function(){this.combineSuffixNode(this.root),this.prepDFS(),this.countDegree(this.root),this.prepDFS(),this.collapseChains(this.root)},combineSuffixNode:function(t){if(t._c)return t;let n=[];this.isTerminal(t)&&n.push("!");const e=this.nodeProps(t);for(let o=0;o<e.length;o++){const s=e[o];"object"==typeof t[s]?(t[s]=this.combineSuffixNode(t[s]),n.push(s),n.push(t[s]._c)):n.push(s)}n=n.join("-");const o=this.suffixes[n];return o||(this.suffixes[n]=t,t._c=this.cNext++,t)},prepDFS:function(){this.vCur++},visited:function(t){return t._v===this.vCur||(t._v=this.vCur,!1)},countDegree:function(t){if(void 0===t._d&&(t._d=0),t._d++,this.visited(t))return;const n=this.nodeProps(t,!0);for(let e=0;e<n.length;e++)this.countDegree(t[n[e]])},collapseChains:function(t){let n,e,o,s;if(!this.visited(t)){for(e=this.nodeProps(t),s=0;s<e.length;s++)"object"==typeof(o=t[n=e[s]])&&(this.collapseChains(o),void 0===o._g||1!==o._d&&1!==o._g.length||(delete t[n],t[n+=o._g]=o[o._g]));1!==e.length||this.isTerminal(t)||(t._g=n)}},isTerminal:function(t){return!!t[""]},uniqueNode:function(t,n,e){const o=this.nodeProps(e,!0);for(let s=0;s<o.length;s++){const i=o[s];if(i===t.slice(0,i.length))return i!==n.slice(0,i.length)?e[i]:this.uniqueNode(t.slice(i.length),n.slice(i.length),e[i])}},pack:function(){return pack_1(this)}};const Trie=function(t){this.root={},this.lastWord="",this.suffixes={},this.suffixCounts={},this.cNext=1,this.wordCount=0,this.insertWords(t),this.vCur=0};Object.keys(methods$1).forEach(function(t){Trie.prototype[t]=methods$1[t]});var trie=Trie;const isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},handleFormats=function(t){return null==t?{}:"string"==typeof t?t.split(/ +/g).reduce(function(t,n){return t[n]=!0,t},{}):isArray(t)?t.reduce(function(t,n){return t[n]=!0,t},{}):t},pack$1=function(t){var n;t=null==(n=t)?{}:"string"==typeof n?n.split(/ +/g).reduce(function(t,n){return t[n]=!0,t},{}):isArray(n)?n.reduce(function(t,n){return t[n]=!0,t},{}):n;const e=Object.keys(t).reduce(function(n,e){const o=t[e];if(isArray(o)){for(let t=0;t<o.length;t++)n[o[t]]=n[o[t]]||[],n[o[t]].push(e);return n}return!1===n.hasOwnProperty(o)&&Object.defineProperty(n,o,{writable:!0,enumerable:!0,configurable:!0,value:[]}),n[o].push(e),n},{});return Object.keys(e).forEach(function(t){const n=new trie(e[t]);e[t]=n.pack()}),Object.keys(e).map(t=>t+"¦"+e[t]).join("|")};var pack_1$1=pack$1,symbols=function(t){const n=new RegExp("([0-9A-Z]+):([0-9A-Z]+)");for(let e=0;e<t.nodes.length;e++){const o=n.exec(t.nodes[e]);if(!o){t.symCount=e;break}t.syms[encoding.fromAlphaCode(o[1])]=encoding.fromAlphaCode(o[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)};const indexFromRef=function(t,n,e){const o=encoding.fromAlphaCode(n);return o<t.symCount?t.syms[o]:e+o+1-t.symCount},toArray=function(t){const n=[],e=(o,s)=>{let i=t.nodes[o];"!"===i[0]&&(n.push(s),i=i.slice(1));const r=i.split(/([A-Z0-9,]+)/g);for(let i=0;i<r.length;i+=2){const c=r[i],u=r[i+1];if(!c)continue;const f=s+c;if(","===u||void 0===u){n.push(f);continue}const l=indexFromRef(t,u,o);e(l,f)}};return e(0,""),n},unpack=function(t){const n={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&&symbols(n),toArray(n)};var unpack_1=unpack,unpack_1$1=function(t){const n=t.split("|").reduce((t,n)=>{const e=n.split("¦");return t[e[0]]=e[1],t},{}),e={};return Object.keys(n).forEach(function(t){const o=unpack_1(n[t]);"true"===t&&(t=!0);for(let n=0;n<o.length;n++){const s=o[n];!0===e.hasOwnProperty(s)?!1===Array.isArray(e[s])?e[s]=[e[s],t]:e[s].push(t):e[s]=t}}),e},src=createCommonjsModule(function(t){const n={pack:pack_1$1,unpack:unpack_1$1};"undefined"!=typeof self?self.efrt=n:"undefined"!=typeof window?window.efrt=n:void 0!==commonjsGlobal&&(commonjsGlobal.efrt=n),t.exports=n});module.exports=src;
//# sourceMappingURL=efrt.min.js.map
