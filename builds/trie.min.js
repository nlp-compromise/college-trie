!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.trie=e()}}(function(){return function e(t,n,i){function r(s,u){if(!n[s]){if(!t[s]){var f="function"==typeof require&&require;if(!u&&f)return f(s,!0);if(o)return o(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var h=n[s]={exports:{}};t[s][0].call(h.exports,function(e){var n=t[s][1][e];return r(n?n:e)},h,h.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){i(this,e),this.counts={}}return r(e,[{key:"init",value:function(e){void 0===this.counts[e]&&(this.counts[e]=0)}},{key:"add",value:function(e,t){void 0===t&&(t=1),this.init(e),this.counts[e]+=t}},{key:"change",value:function(e,t,n){void 0===n&&(n=1),this.add(t,-n),this.add(e,n)}},{key:"countOf",value:function(e){return this.init(e),this.counts[e]}},{key:"highest",value:function(e){for(var t=[],n=Object.keys(this.counts),i=0;i<n.length;i++){var r=n[i];t.push([r,this.counts[r]])}return t.sort(function(e,t){return t[1]-e[1]}),e&&(t=t.slice(0,e)),t}}]),e}();t.exports=o},{}],2:[function(e,t,n){"use strict";var i=e("./trie");t.exports=i},{"./trie":4}],3:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=";",s=",",u="!",f=36,a="zzzzzzzzzz",h=function(e){var t,n,i,r="";for(t=1,n=f;e>=n;e-=n,t++,n*=f);for(;t--;)i=e%f,r=String.fromCharCode((i<10?48:55)+i)+r,e=(e-i)/f;return r},l=function(e){var t,n,i,r,o,s=0;for(t=1,n=f;t<e.length;s+=n,t++,n*=f);for(r=e.length-1,i=1;r>=0;r--,i*=f)o=e.charCodeAt(r)-48,o>10&&(o-=7),s+=o*i;return s},c=new RegExp("([a-z ]+)("+s+"|[0-9A-Z]+|$)","g"),v=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),d=function(){function e(t){for(i(this,e),this.nodes=t.split(o),this.syms=[],this.symCount=0;;){var n=v.exec(this.nodes[0]);if(!n)break;this.syms[l(n[1])]=l(n[2]),this.symCount++,this.nodes.shift()}}return r(e,[{key:"isWord",value:function(e){return""!==e&&this.match(e)===e}},{key:"match",value:function(e){var t=this.matches(e);return 0===t.length?"":t[t.length-1]}},{key:"matches",value:function(e){return this.words(e,e+"a")}},{key:"max",value:function(){return a}},{key:"words",value:function e(t,n,i){function r(t){return e.length>=i?void(this.abort=!0):void e.push(t)}var e=[];return void 0===t&&(t=""),"number"==typeof n&&(i=n,n=void 0),void 0===n&&(n=this.beyond(t)),this.enumerate(0,"",{from:t,beyond:n,fn:r,prefixes:t+"a"===n}),e}},{key:"enumerate",value:function(e,t,n){function i(e){return n.prefixes?void(e===n.from.slice(0,e.length)&&n.fn(e)):void(n.from<=e&&e<n.beyond&&n.fn(e))}var r=this.nodes[e],o=this;if(r[0]===u){if(i(t),n.abort)return;r=r.slice(1)}r.replace(c,function(r,u,f){var a=t+u;if(!(n.abort||a>=n.beyond||a<n.from.slice(0,a.length))){var h=f===s||""===f;return h?void i(a):void o.enumerate(o.inodeFromRef(f,e),a,n)}})}},{key:"inodeFromRef",value:function(e,t){var n=l(e);return n<this.symCount?this.syms[n]:t+n+1-this.symCount}},{key:"beyond",value:function(e){if(0===e.length)return this.max();var t=e.charCodeAt(e.length-1);return e.slice(0,-1)+String.fromCharCode(t+1)}}]),e}();t.exports={PackedTrie:d,NODE_SEP:o,STRING_SEP:s,TERMINAL_PREFIX:u,toAlphaCode:h,fromAlphaCode:l,BASE:f}},{}],4:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=e("./ptrie"),u=e("./histogram"),f=function(e){e.sort();for(var t=1;t<e.length;t++)e[t-1]===e[t]&&e.splice(t,1)},a=function(e,t){for(var n=Math.min(e.length,t.length);n>0;){var i=e.slice(0,n);if(i===t.slice(0,n))return i;n-=1}return""},h=function(){function e(t){i(this,e),this.root={},this.lastWord="",this.suffixes={},this.suffixCounts={},this.cNext=1,this.wordCount=0,this.insertWords(t),this.vCur=0}return o(e,[{key:"insertWords",value:function(e){"string"==typeof e&&(e=e.split(/\n/)),f(e);for(var t=0;t<e.length;t++)this.insert(e[t])}},{key:"insert",value:function(e){this._insert(e,this.root);var t=this.lastWord;this.lastWord=e;var n=a(e,t);if(n!==t){var i=this.uniqueNode(t,e,this.root);i&&this.combineSuffixNode(i)}}},{key:"_insert",value:function(e,t){for(var n=Object.keys(t),i=0;i<n.length;i++){var o=n[i],s=a(e,o);if(0!==s.length){if(o===s&&"object"===r(t[o]))return void this._insert(e.slice(s.length),t[o]);if(o===e&&"number"==typeof t[o])return;var u={};return u[o.slice(s.length)]=t[o],this.addTerminal(u,e=e.slice(s.length)),delete t[o],t[s]=u,void this.wordCount++}}this.addTerminal(t,e),this.wordCount++}},{key:"addTerminal",value:function(e,t){if(t.length<=1)return void(e[t]=1);var n={};e[t[0]]=n,this.addTerminal(n,t.slice(1))}},{key:"nodeProps",value:function(e,t){var n=[];for(var i in e)""!==i&&"_"!==i[0]&&(t&&"object"!==r(e[i])||n.push(i));return n.sort(),n}},{key:"optimize",value:function(){this.combineSuffixNode(this.root),this.prepDFS(),this.countDegree(this.root),this.prepDFS(),this.collapseChains(this.root)}},{key:"combineSuffixNode",value:function(e){if(e._c)return e;var t=[];this.isTerminal(e)&&t.push("!");for(var n=this.nodeProps(e),i=0;i<n.length;i++){var o=n[i];"object"===r(e[o])?(e[o]=this.combineSuffixNode(e[o]),t.push(o),t.push(e[o]._c)):t.push(o)}t=t.join("-");var s=this.suffixes[t];return s?s:(this.suffixes[t]=e,e._c=this.cNext++,e)}},{key:"prepDFS",value:function(){this.vCur++}},{key:"visited",value:function(e){return e._v===this.vCur||(e._v=this.vCur,!1)}},{key:"countDegree",value:function(e){if(void 0===e._d&&(e._d=0),e._d++,!this.visited(e))for(var t=this.nodeProps(e,!0),n=0;n<t.length;n++)this.countDegree(e[t[n]])}},{key:"collapseChains",value:function(e){var t=void 0,n=void 0,i=void 0,o=void 0;if(!this.visited(e)){for(n=this.nodeProps(e),o=0;o<n.length;o++)t=n[o],i=e[t],"object"===("undefined"==typeof i?"undefined":r(i))&&(this.collapseChains(i),void 0===i._g||1!==i._d&&1!==i._g.length||(delete e[t],t+=i._g,e[t]=i[i._g]));1!==n.length||this.isTerminal(e)||(e._g=t)}}},{key:"isWord",value:function(e){return this.isFragment(e,this.root)}},{key:"isTerminal",value:function(e){return!!e[""]}},{key:"isFragment",value:function(e,t){if(0===e.length)return this.isTerminal(t);if(1===t[e])return!0;for(var n=this.nodeProps(t,!0),i=0;i<n.length;i++){var r=n[i];if(r===e.slice(0,r.length))return this.isFragment(e.slice(r.length),t[r])}return!1}},{key:"uniqueNode",value:function(e,t,n){for(var i=this.nodeProps(n,!0),r=0;r<i.length;r++){var o=i[r];if(o===e.slice(0,o.length))return o!==t.slice(0,o.length)?n[o]:this.uniqueNode(e.slice(o.length),t.slice(o.length),n[o])}}},{key:"pack",value:function(){function e(e){var t="",n="";r.isTerminal(e)&&(t+=s.TERMINAL_PREFIX);for(var i=r.nodeProps(e),o=0;o<i.length;o++){var u=i[o];if("number"!=typeof e[u])if(a[e[u]._n])t+=n+u+a[e[u]._n],n="";else{var f=s.toAlphaCode(e._n-e[u]._n-1+h);e[u]._g&&f.length>=e[u]._g.length&&1===e[e[u]._g]?(f=e[u]._g,n=s.STRING_SEP):(t+=n+u+f,n="")}else t+=n+u,n=s.STRING_SEP}return t}function t(e){if(void 0===e._n){for(var n=r.nodeProps(e,!0),i=0;i<n.length;i++)t(e[n[i]]);e._n=l++,o.unshift(e)}}function n(e){if(!r.visited(e))for(var t=r.nodeProps(e,!0),i=0;i<t.length;i++){var o=t[i],u=e._n-e[o]._n-1;u<s.BASE&&v.add(u),c.add(e[o]._n,s.toAlphaCode(u).length-1),n(e[o])}}function i(){c=c.highest(s.BASE);var e=[];e[-1]=0;for(var t=0,n=0,i=3+s.toAlphaCode(f).length,r=0;r<s.BASE&&void 0!==c[r];r++)e[r]=c[r][1]-i-v.countOf(s.BASE-r-1)+e[r-1],e[r]>=t&&(t=e[r],n=r+1);return n}var r=this,o=[],f=void 0,a={},h=void 0,l=0;this.optimize();var c=new u,v=new u;t(this.root,0),f=o.length,this.prepDFS(),n(this.root),h=i();for(var d=0;d<h;d++)a[c[d][0]]=s.toAlphaCode(d);for(var p=0;p<f;p++)o[p]=e(o[p]);for(var y=h-1;y>=0;y--)o.unshift(s.toAlphaCode(y)+":"+s.toAlphaCode(f-c[y][0]-1));return o.join(s.NODE_SEP)}}]),e}();t.exports=h},{"./histogram":1,"./ptrie":3}]},{},[2])(2)});
