/* efrt trie-compression v0.0.6  github.com/nlp-compromise/efrt  - MIT */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.efrt=t()}}(function(){var t;return function t(n,e,i){function o(s,u){if(!e[s]){if(!n[s]){var f="function"==typeof require&&require;if(!u&&f)return f(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=e[s]={exports:{}};n[s][0].call(h.exports,function(t){var e=n[s][1][t];return o(e?e:t)},h,h.exports,t,n,e,i)}return e[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,n,e){"use strict";n.exports={NODE_SEP:";",STRING_SEP:",",TERMINAL_PREFIX:"!",NOT_ALLOWED:new RegExp("[0-9A-Z,;!]"),BASE:36}},{}],2:[function(t,n,e){"use strict";var i=36,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",r=o.split("").reduce(function(t,n,e){return t[n]=e,t},{}),s=function(t){if(void 0!==o[t])return o[t];for(var n=1,e=i,r="";t>=e;t-=e,n++,e*=i);for(;n--;){var s=t%i;r=String.fromCharCode((s<10?48:55)+s)+r,t=(t-s)/i}return r},u=function(t){if(void 0!==r[t])return r[t];for(var n=0,e=1,o=i,s=1;e<t.length;n+=o,e++,o*=i);for(var u=t.length-1;u>=0;u--,s*=i){var f=t.charCodeAt(u)-48;f>10&&(f-=7),n+=f*s}return n};n.exports={toAlphaCode:s,fromAlphaCode:u}},{}],3:[function(n,e,i){(function(i){"use strict";var o={pack:n("./pack/index"),unpack:n("./unpack/index")};"undefined"!=typeof self?self.efrt=o:"undefined"!=typeof window?window.efrt=o:"undefined"!=typeof i&&(i.efrt=o),"function"==typeof t&&t.amd&&t(o),"undefined"!=typeof e&&(e.exports=o)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./pack/index":6,"./unpack/index":10}],4:[function(t,n,e){"use strict";var i=function(t,n){for(var e=Math.min(t.length,n.length);e>0;){var i=t.slice(0,e);if(i===n.slice(0,e))return i;e-=1}return""},o=function(t){t.sort();for(var n=1;n<t.length;n++)t[n-1]===t[n]&&t.splice(n,1)};n.exports={commonPrefix:i,unique:o}},{}],5:[function(t,n,e){"use strict";function i(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),r=function(){function t(){i(this,t),this.counts={}}return o(t,[{key:"init",value:function(t){void 0===this.counts[t]&&(this.counts[t]=0)}},{key:"add",value:function(t,n){void 0===n&&(n=1),this.init(t),this.counts[t]+=n}},{key:"change",value:function(t,n,e){void 0===e&&(e=1),this.add(n,-e),this.add(t,e)}},{key:"countOf",value:function(t){return this.init(t),this.counts[t]}},{key:"highest",value:function(t){for(var n=[],e=Object.keys(this.counts),i=0;i<e.length;i++){var o=e[i];n.push([o,this.counts[o]])}return n.sort(function(t,n){return n[1]-t[1]}),t&&(n=n.slice(0,t)),n}}]),t}();n.exports=r},{}],6:[function(t,n,e){"use strict";var i=t("./trie"),o=function(t){var n=new i(t);return n.pack()};n.exports=o},{"./trie":9}],7:[function(t,n,e){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=t("./fns"),r=t("./pack"),s=t("../config");n.exports={insertWords:function(t){if(void 0!==t){"string"==typeof t&&(t=t.split(/[^a-zA-Z]+/));for(var n=0;n<t.length;n++)t[n]=t[n].toLowerCase();o.unique(t);for(var e=0;e<t.length;e++)null===t[e].match(s.NOT_ALLOWED)&&this.insert(t[e])}},insert:function(t){this._insert(t,this.root);var n=this.lastWord;this.lastWord=t;var e=o.commonPrefix(t,n);if(e!==n){var i=this.uniqueNode(n,t,this.root);i&&this.combineSuffixNode(i)}},_insert:function(t,n){var e=void 0,r=void 0;if(0!==t.length){for(var s=Object.keys(n),u=0;u<s.length;u++){var f=s[u];if(e=o.commonPrefix(t,f),0!==e.length){if(f===e&&"object"===i(n[f]))return void this._insert(t.slice(e.length),n[f]);if(f===t&&"number"==typeof n[f])return;return r={},r[f.slice(e.length)]=n[f],this.addTerminal(r,t=t.slice(e.length)),delete n[f],n[e]=r,void this.wordCount++}}this.addTerminal(n,t),this.wordCount++}},addTerminal:function(t,n){if(n.length<=1)return void(t[n]=1);var e={};t[n[0]]=e,this.addTerminal(e,n.slice(1))},nodeProps:function(t,n){var e=[];for(var o in t)""!==o&&"_"!==o[0]&&(n&&"object"!==i(t[o])||e.push(o));return e.sort(),e},optimize:function(){this.combineSuffixNode(this.root),this.prepDFS(),this.countDegree(this.root),this.prepDFS(),this.collapseChains(this.root)},combineSuffixNode:function(t){if(t._c)return t;var n=[];this.isTerminal(t)&&n.push("!");for(var e=this.nodeProps(t),o=0;o<e.length;o++){var r=e[o];"object"===i(t[r])?(t[r]=this.combineSuffixNode(t[r]),n.push(r),n.push(t[r]._c)):n.push(r)}n=n.join("-");var s=this.suffixes[n];return s?s:(this.suffixes[n]=t,t._c=this.cNext++,t)},prepDFS:function(){this.vCur++},visited:function(t){return t._v===this.vCur||(t._v=this.vCur,!1)},countDegree:function(t){if(void 0===t._d&&(t._d=0),t._d++,!this.visited(t))for(var n=this.nodeProps(t,!0),e=0;e<n.length;e++)this.countDegree(t[n[e]])},collapseChains:function(t){var n=void 0,e=void 0,o=void 0,r=void 0;if(!this.visited(t)){for(e=this.nodeProps(t),r=0;r<e.length;r++)n=e[r],o=t[n],"object"===("undefined"==typeof o?"undefined":i(o))&&(this.collapseChains(o),void 0===o._g||1!==o._d&&1!==o._g.length||(delete t[n],n+=o._g,t[n]=o[o._g]));1!==e.length||this.isTerminal(t)||(t._g=n)}},has:function(t){return this.isFragment(t,this.root)},isTerminal:function(t){return!!t[""]},isFragment:function(t,n){if(0===t.length)return this.isTerminal(n);if(1===n[t])return!0;for(var e=this.nodeProps(n,!0),i=0;i<e.length;i++){var o=e[i];if(o===t.slice(0,o.length))return this.isFragment(t.slice(o.length),n[o])}return!1},uniqueNode:function(t,n,e){for(var i=this.nodeProps(e,!0),o=0;o<i.length;o++){var r=i[o];if(r===t.slice(0,r.length))return r!==n.slice(0,r.length)?e[r]:this.uniqueNode(t.slice(r.length),n.slice(r.length),e[r])}},pack:function(){return r(this)}}},{"../config":1,"./fns":4,"./pack":8}],8:[function(t,n,e){"use strict";var i=t("./histogram"),o=t("../config"),r=t("../encoding"),s=function(t,n){var e="",i="";t.isTerminal(n)&&(e+=o.TERMINAL_PREFIX);for(var s=t.nodeProps(n),u=0;u<s.length;u++){var f=s[u];if("number"!=typeof n[f])if(t.syms[n[f]._n])e+=i+f+t.syms[n[f]._n],i="";else{var c=r.toAlphaCode(n._n-n[f]._n-1+t.symCount);n[f]._g&&c.length>=n[f]._g.length&&1===n[n[f]._g]?(c=n[f]._g,e+=i+f+c,i=o.STRING_SEP):(e+=i+f+c,i="")}else e+=i+f,i=o.STRING_SEP}return e},u=function t(n,e){if(!n.visited(e))for(var i=n.nodeProps(e,!0),s=0;s<i.length;s++){var u=i[s],f=e._n-e[u]._n-1;f<o.BASE&&n.histRel.add(f),n.histAbs.add(e[u]._n,r.toAlphaCode(f).length-1),t(n,e[u])}},f=function(t){t.histAbs=t.histAbs.highest(o.BASE);var n=[];n[-1]=0;for(var e=0,i=0,s=3+r.toAlphaCode(t.nodeCount).length,u=0;u<o.BASE&&void 0!==t.histAbs[u];u++)n[u]=t.histAbs[u][1]-s-t.histRel.countOf(o.BASE-u-1)+n[u-1],n[u]>=e&&(e=n[u],i=u+1);return i},c=function t(n,e){if(void 0===e._n){for(var i=n.nodeProps(e,!0),o=0;o<i.length;o++)t(n,e[i[o]]);e._n=n.pos++,n.nodes.unshift(e)}},h=function(t){t.nodes=[],t.nodeCount=0,t.syms={},t.symCount=0,t.pos=0,t.optimize(),t.histAbs=new i,t.histRel=new i,c(t,t.root),t.nodeCount=t.nodes.length,t.prepDFS(),u(t,t.root),t.symCount=f(t);for(var n=0;n<t.symCount;n++)t.syms[t.histAbs[n][0]]=r.toAlphaCode(n);for(var e=0;e<t.nodeCount;e++)t.nodes[e]=s(t,t.nodes[e]);for(var h=t.symCount-1;h>=0;h--)t.nodes.unshift(r.toAlphaCode(h)+":"+r.toAlphaCode(t.nodeCount-t.histAbs[h][0]-1));return t.nodes.join(o.NODE_SEP)};n.exports=h},{"../config":1,"../encoding":2,"./histogram":5}],9:[function(t,n,e){"use strict";var i=t("./methods"),o=function(t){this.root={},this.lastWord="",this.suffixes={},this.suffixCounts={},this.cNext=1,this.wordCount=0,this.insertWords(t),this.vCur=0};Object.keys(i).forEach(function(t){o.prototype[t]=i[t]}),n.exports=o},{"./methods":7}],10:[function(t,n,e){"use strict";var i=t("./ptrie");n.exports=function(t){return new i(t)}},{"./ptrie":13}],11:[function(t,n,e){"use strict";var i=t("../encoding"),o=t("./prefix"),r=t("./unravel"),s={has:function(t){if(!t)return!1;if(this._cache)return this._cache[t]||!1;var n=this,e=function e(i,r){var s=n.nodes[i];if("!"===s[0]){if(r===t)return!0;s=s.slice(1)}for(var u=s.split(/([A-Z0-9,]+)/g),f=0;f<u.length;f+=2){var c=u[f],h=u[f+1];if(c){var a=r+c;if(","!==h&&void 0!==h){if(o(a,t))return i=n.indexFromRef(h,i),e(i,a)}else if(a===t)return!0}}return!1};return e(0,"")},indexFromRef:function(t,n){var e=i.fromAlphaCode(t);return e<this.symCount?this.syms[e]:n+e+1-this.symCount},toArray:function(){return Object.keys(this.toObject())},toObject:function(){return this._cache?this._cache:r(this)},cache:function(){this._cache=r(this),this.nodes=null,this.syms=null}};n.exports=s},{"../encoding":2,"./prefix":12,"./unravel":15}],12:[function(t,n,e){"use strict";n.exports=function(t,n){if(t===n)return!0;var e=t.length;return!(e>=n.length)&&(1===e?t===n[0]:n.slice(0,e)===t)}},{}],13:[function(t,n,e){"use strict";var i=t("./symbols"),o=t("./methods"),r=function(t){this.nodes=t.split(";"),this.syms=[],this.symCount=0,this._cache=null,t.match(":")&&i(this)};Object.keys(o).forEach(function(t){r.prototype[t]=o[t]}),n.exports=r},{"./methods":11,"./symbols":14}],14:[function(t,n,e){"use strict";var i=t("../encoding");n.exports=function(t){for(var n=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),e=0;e<t.nodes.length;e++){var o=n.exec(t.nodes[e]);if(!o){t.symCount=e;break}t.syms[i.fromAlphaCode(o[1])]=i.fromAlphaCode(o[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)}},{"../encoding":2}],15:[function(t,n,e){"use strict";n.exports=function(t){var n={},e=function e(i,o){var r=t.nodes[i];"!"===r[0]&&(n[o]=!0,r=r.slice(1));for(var s=r.split(/([A-Z0-9,]+)/g),u=0;u<s.length;u+=2){var f=s[u],c=s[u+1];if(f){var h=o+f;if(","!==c&&void 0!==c){var a=t.indexFromRef(c,i);e(a,h)}else n[h]=!0}}};return e(0,""),n}},{}]},{},[3])(3)});
