!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.efrt=t()}}(function(){return function t(e,n,i){function o(s,u){if(!n[s]){if(!e[s]){var f="function"==typeof require&&require;if(!u&&f)return f(s,!0);if(r)return r(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return o(n?n:t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){"use strict";e.exports={NODE_SEP:";",STRING_SEP:",",TERMINAL_PREFIX:"!",BASE:36}},{}],2:[function(t,e,n){"use strict";var i=t("./config"),o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",r=o.split("").reduce(function(t,e,n){return t[e]=n,t},{}),s=function(t){if(void 0!==o[t])return o[t];for(var e=1,n=i.BASE,r="";t>=n;t-=n,e++,n*=i.BASE);for(;e--;){var s=t%i.BASE;r=String.fromCharCode((s<10?48:55)+s)+r,t=(t-s)/i.BASE}return r},u=function(t){if(void 0!==r[t])return r[t];for(var e=0,n=1,o=i.BASE,s=1;n<t.length;e+=o,n++,o*=i.BASE);for(var u=t.length-1;u>=0;u--,s*=i.BASE){var f=t.charCodeAt(u)-48;f>10&&(f-=7),e+=f*s}return e},f=function(t){t.sort();for(var e=1;e<t.length;e++)t[e-1]===t[e]&&t.splice(e,1)},a=function(t,e){for(var n=Math.min(t.length,e.length);n>0;){var i=t.slice(0,n);if(i===e.slice(0,n))return i;n-=1}return""};e.exports={toAlphaCode:s,fromAlphaCode:u,unique:f,commonPrefix:a}},{"./config":1}],3:[function(t,e,n){"use strict";e.exports={pack:t("./pack/index"),unpack:t("./unpack/index")}},{"./pack/index":5,"./unpack/index":8}],4:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){i(this,t),this.counts={}}return o(t,[{key:"init",value:function(t){void 0===this.counts[t]&&(this.counts[t]=0)}},{key:"add",value:function(t,e){void 0===e&&(e=1),this.init(t),this.counts[t]+=e}},{key:"change",value:function(t,e,n){void 0===n&&(n=1),this.add(e,-n),this.add(t,n)}},{key:"countOf",value:function(t){return this.init(t),this.counts[t]}},{key:"highest",value:function(t){for(var e=[],n=Object.keys(this.counts),i=0;i<n.length;i++){var o=n[i];e.push([o,this.counts[o]])}return e.sort(function(t,e){return e[1]-t[1]}),t&&(e=e.slice(0,t)),e}}]),t}();e.exports=r},{}],5:[function(t,e,n){"use strict";var i=t("./trie"),o=function(t){var e=new i(t);return e.pack()};e.exports=o},{"./trie":7}],6:[function(t,e,n){"use strict";var i=t("./histogram"),o=t("../config"),r=t("../fns"),s=function(t,e){var n="",i="";t.isTerminal(e)&&(n+=o.TERMINAL_PREFIX);for(var s=t.nodeProps(e),u=0;u<s.length;u++){var f=s[u];if("number"!=typeof e[f])if(t.syms[e[f]._n])n+=i+f+t.syms[e[f]._n],i="";else{var a=r.toAlphaCode(e._n-e[f]._n-1+t.symCount);e[f]._g&&a.length>=e[f]._g.length&&1===e[e[f]._g]?(a=e[f]._g,n+=i+f+a,i=o.STRING_SEP):(n+=i+f+a,i="")}else n+=i+f,i=o.STRING_SEP}return n},u=function t(e,n){if(!e.visited(n))for(var i=e.nodeProps(n,!0),s=0;s<i.length;s++){var u=i[s],f=n._n-n[u]._n-1;f<o.BASE&&e.histRel.add(f),e.histAbs.add(n[u]._n,r.toAlphaCode(f).length-1),t(e,n[u])}},f=function(t){t.histAbs=t.histAbs.highest(o.BASE);var e=[];e[-1]=0;for(var n=0,i=0,s=3+r.toAlphaCode(t.nodeCount).length,u=0;u<o.BASE&&void 0!==t.histAbs[u];u++)e[u]=t.histAbs[u][1]-s-t.histRel.countOf(o.BASE-u-1)+e[u-1],e[u]>=n&&(n=e[u],i=u+1);return i},a=function t(e,n){if(void 0===n._n){for(var i=e.nodeProps(n,!0),o=0;o<i.length;o++)t(e,n[i[o]]);n._n=e.pos++,e.nodes.unshift(n)}},c=function(t){t.nodes=[],t.nodeCount=0,t.syms={},t.symCount=0,t.pos=0,t.optimize(),t.histAbs=new i,t.histRel=new i,a(t,t.root),t.nodeCount=t.nodes.length,t.prepDFS(),u(t,t.root),t.symCount=f(t);for(var e=0;e<t.symCount;e++)t.syms[t.histAbs[e][0]]=r.toAlphaCode(e);for(var n=0;n<t.nodeCount;n++)t.nodes[n]=s(t,t.nodes[n]);for(var c=t.symCount-1;c>=0;c--)t.nodes.unshift(r.toAlphaCode(c)+":"+r.toAlphaCode(t.nodeCount-t.histAbs[c][0]-1));return t.nodes.join(o.NODE_SEP)};e.exports=c},{"../config":1,"../fns":2,"./histogram":4}],7:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=t("../fns"),u=t("./pack"),f=function(){function t(e){i(this,t),this.root={},this.lastWord="",this.suffixes={},this.suffixCounts={},this.cNext=1,this.wordCount=0,this.insertWords(e),this.vCur=0}return r(t,[{key:"insertWords",value:function(t){if(void 0!==t){"string"==typeof t&&(t=t.split(/[^a-zA-Z]+/));for(var e=0;e<t.length;e++)t[e]=t[e].toLowerCase();s.unique(t);for(var n=0;n<t.length;n++)this.insert(t[n])}}},{key:"insert",value:function(t){this._insert(t,this.root);var e=this.lastWord;this.lastWord=t;var n=s.commonPrefix(t,e);if(n!==e){var i=this.uniqueNode(e,t,this.root);i&&this.combineSuffixNode(i)}}},{key:"_insert",value:function(t,e){var n=void 0,i=void 0;if(0!==t.length){for(var r=Object.keys(e),u=0;u<r.length;u++){var f=r[u];if(n=s.commonPrefix(t,f),0!==n.length){if(f===n&&"object"===o(e[f]))return void this._insert(t.slice(n.length),e[f]);if(f===t&&"number"==typeof e[f])return;return i={},i[f.slice(n.length)]=e[f],this.addTerminal(i,t=t.slice(n.length)),delete e[f],e[n]=i,void this.wordCount++}}this.addTerminal(e,t),this.wordCount++}}},{key:"addTerminal",value:function(t,e){if(e.length<=1)return void(t[e]=1);var n={};t[e[0]]=n,this.addTerminal(n,e.slice(1))}},{key:"nodeProps",value:function(t,e){var n=[];for(var i in t)""!==i&&"_"!==i[0]&&(e&&"object"!==o(t[i])||n.push(i));return n.sort(),n}},{key:"optimize",value:function(){this.combineSuffixNode(this.root),this.prepDFS(),this.countDegree(this.root),this.prepDFS(),this.collapseChains(this.root)}},{key:"combineSuffixNode",value:function(t){if(t._c)return t;var e=[];this.isTerminal(t)&&e.push("!");for(var n=this.nodeProps(t),i=0;i<n.length;i++){var r=n[i];"object"===o(t[r])?(t[r]=this.combineSuffixNode(t[r]),e.push(r),e.push(t[r]._c)):e.push(r)}e=e.join("-");var s=this.suffixes[e];return s?s:(this.suffixes[e]=t,t._c=this.cNext++,t)}},{key:"prepDFS",value:function(){this.vCur++}},{key:"visited",value:function(t){return t._v===this.vCur||(t._v=this.vCur,!1)}},{key:"countDegree",value:function(t){if(void 0===t._d&&(t._d=0),t._d++,!this.visited(t))for(var e=this.nodeProps(t,!0),n=0;n<e.length;n++)this.countDegree(t[e[n]])}},{key:"collapseChains",value:function(t){var e=void 0,n=void 0,i=void 0,r=void 0;if(!this.visited(t)){for(n=this.nodeProps(t),r=0;r<n.length;r++)e=n[r],i=t[e],"object"===("undefined"==typeof i?"undefined":o(i))&&(this.collapseChains(i),void 0===i._g||1!==i._d&&1!==i._g.length||(delete t[e],e+=i._g,t[e]=i[i._g]));1!==n.length||this.isTerminal(t)||(t._g=e)}}},{key:"has",value:function(t){return this.isFragment(t,this.root)}},{key:"isTerminal",value:function(t){return!!t[""]}},{key:"isFragment",value:function(t,e){if(0===t.length)return this.isTerminal(e);if(1===e[t])return!0;for(var n=this.nodeProps(e,!0),i=0;i<n.length;i++){var o=n[i];if(o===t.slice(0,o.length))return this.isFragment(t.slice(o.length),e[o])}return!1}},{key:"uniqueNode",value:function(t,e,n){for(var i=this.nodeProps(n,!0),o=0;o<i.length;o++){var r=i[o];if(r===t.slice(0,r.length))return r!==e.slice(0,r.length)?n[r]:this.uniqueNode(t.slice(r.length),e.slice(r.length),n[r])}}},{key:"pack",value:function(){return u(this)}}]),t}();e.exports=f},{"../fns":2,"./pack":6}],8:[function(t,e,n){"use strict";var i=t("./ptrie"),o=function(t){return new i(t)};e.exports=o},{"./ptrie":10}],9:[function(t,e,n){"use strict";var i=function(t,e){if(t===e)return!0;var n=t.length;return!(n>=e.length)&&(1===n?t===e[0]:e.slice(0,n)===t)};e.exports=i},{}],10:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=t("../config"),s=t("../fns"),u=t("./prefix"),f=function(){function t(e){i(this,t),this.nodes=e.split(r.NODE_SEP),this.syms=[],this.symCount=0,e.match(":")&&this.initSymbols()}return o(t,[{key:"initSymbols",value:function(){for(var t=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),e=0;e<this.nodes.length;e++){var n=t.exec(this.nodes[e]);if(!n){this.symCount=e;break}this.syms[s.fromAlphaCode(n[1])]=s.fromAlphaCode(n[2])}this.nodes=this.nodes.slice(this.symCount,this.nodes.length)}},{key:"has",value:function(t){var e=this;if(!t)return!1;var n=function n(i,o){var r=e.nodes[i];if("!"===r[0]){if(o===t)return!0;r=r.slice(1)}for(var s=r.split(/([A-Z0-9,]+)/g),f=0;f<s.length;f+=2){var a=s[f],c=s[f+1];if(a){var h=o+a;if(","!==c&&void 0!==c){if(u(h,t))return i=e.inodeFromRef(c,i),n(i,h)}else if(h===t)return!0}}return!1};return n(0,"")}},{key:"inodeFromRef",value:function(t,e){var n=s.fromAlphaCode(t);return n<this.symCount?this.syms[n]:e+n+1-this.symCount}}]),t}();e.exports=f},{"../config":1,"../fns":2,"./prefix":9}]},{},[3])(3)});
